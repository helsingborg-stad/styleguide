@use "../mixin/cover";
@use "../setting/var_border-radius";
@use "../setting/var_colors";
@use "../setting/var_default";
@use "../setting/var_properties";

/* Component CSS Variables */

/* File Input Colors */
$c-fileinput-background-color: var(--c-fileinput-background-color, var(--color--surface));
$c-fileinput-border-color: var(--c-fileinput-border-color, var(--color--border));
$c-fileinput-drag-outline-color: var(--c-fileinput-drag-outline-color, var(--color--lighter));
$c-fileinput-item-background: var(--c-fileinput-item-background, var(--color--white));
$c-fileinput-item-border-color: var(--c-fileinput-item-border-color, var(--color--lighter));
$c-fileinput-success-color: var(--c-fileinput-success-color, var(--color--success));
$c-fileinput-danger-color: var(--c-fileinput-danger-color, var(--color--error));
$c-fileinput-danger-background: var(--c-fileinput-danger-background, var(--color--lighter));

/* File Input Borders & Radius */
$c-fileinput-border-width: var(--c-fileinput-border-width, var(--border-width-input));
$c-fileinput-border-radius: var(--c-fileinput-border-radius, var(--radius-sm));
$c-fileinput-item-border-radius: var(--c-fileinput-item-border-radius, var(--radius-lg));
$c-fileinput-preview-border-radius: var(--c-fileinput-preview-border-radius, var(--radius-md));

/* File Input Shadows */
$c-fileinput-item-shadow: var(--c-fileinput-item-shadow, var(--shadow-1));
$c-fileinput-preview-shadow: var(--c-fileinput-preview-shadow, var(--shadow-2));

/* File Input Spacing */
$c-fileinput-area-padding: var(--c-fileinput-area-padding, var(--spacing-md));
$c-fileinput-list-padding: var(--c-fileinput-list-padding, var(--spacing-sm));
$c-fileinput-list-gap: var(--c-fileinput-list-gap, var(--spacing-sm));
$c-fileinput-item-height: var(--c-fileinput-item-height, calc(var(--base) * 5.5));

/* File Input Typography */
$c-fileinput-meta-font-size: var(--c-fileinput-meta-font-size, 0.7em);

.c-fileinput {

    /* Actual input (hide) */
    .c-fileinput__input {
        width: 1px;
        height: 1px;
        position: absolute;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
        padding: 0;
        margin: 0;
        opacity: 0;
        z-index: -1;
    }

    /* Is dragging animations */
    &.is-dragging:not(.is-full) {
        .js-file-input-drop {
            outline: 3px dashed $c-fileinput-drag-outline-color;
            border-radius: $c-fileinput-item-border-radius;
            corner-shape: var(--corner-shape);
            outline-offset: calc(#{var(--base)} * 1.5);
            width: calc(#{var(--base)} * 40);
            max-width: calc(100% - calc(#{var(--base)} * 2.5));
            display: flex;
        }

        .js-file-input-button {
            display: none;
        }
    }

    

    &.is-dragging.is-full {
        .js-file-input-drop {
            display: none;
        }

        // Disable drop area visually
        .c-fileinput__area {
            &::after {
                @include cover.cover();
                content: "\1F6AB"; /* Unicode for ðŸš« */
                font-size: 3rem; /* Adjust the size as needed */
                display: flex;
                justify-content: center;
                align-items: center;
                text-align: center; /* Center the content horizontally */
                line-height: 1; /* Adjust line height to remove any extra space */
                filter: grayscale(100%) brightness(0) contrast(100%);
                opacity: .2;
                z-index: var(--level-2);
            }
            &::before {
                content: "";
                @include cover.cover();
                background: rgba(255, 255, 255, 0.5); /* Dim the background */
                z-index: var(--level-1);
            }
        }
    }

    &:not(.is-dragging) {
        .js-file-input-drop {
            display: none;
        }
    }

    .js-file-input-button,
    .js-file-input-drop {
        animation: puff-in-center 0.2s cubic-bezier(0.470, 0.000, 0.745, 0.715) both;
    }

    /* Drop area */
    .c-fileinput__area {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: $c-fileinput-area-padding;
        border-radius: $c-fileinput-border-radius;
        corner-shape: var(--corner-shape);
        background-color: $c-fileinput-background-color;
        border: $c-fileinput-border-width solid $c-fileinput-border-color;
        box-shadow: inset 0 0 50px 50px rgba(0,0,0,0.02);
        transition: all 0.2s ease-in-out;
    }

    /* List container */
    .c-fileinput__file-list {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        gap: $c-fileinput-list-gap;
        margin-top: $c-fileinput-list-gap;
        width: 100%;
        padding: $c-fileinput-list-padding;
    }

    /* Items uploaded */
    .c-fileinput__item {
        .c-fileinput__item-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 calc(#{var(--base)} * .5);
            background-color: $c-fileinput-item-background;
            border-radius: $c-fileinput-item-border-radius;
            corner-shape: var(--corner-shape);
            margin: 0;
            filter: $c-fileinput-item-shadow;
            height: $c-fileinput-item-height;
            animation: puff-in-center 0.2s cubic-bezier(0.470, 0.000, 0.745, 0.715) both;
        }

        .c-fileinput__item-remove {
            border-left: 1px solid $c-fileinput-item-border-color;
            margin-left: calc(#{var(--base)} * 2);
            border-radius: 0 100px 100px 0;
        }

        .c-fileinput__item-icon-wrapper {
            aspect-ratio: 1 / 1;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .c-fileinput__item-text {
            display: flex;
            flex-wrap: nowrap;
            align-items: center;
            gap: #{var(--base)};

            .c-fileinput__item-name {
                max-width: calc(#{var(--base)} * 20);
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .c-fileinput__item-size {
                white-space: nowrap;
                font-size: $c-fileinput-meta-font-size;

                &::before {
                    content: "(";
                }
                &::after {
                    content: ")";
                }
            }
        }
    }

    /* Is empty */
    &.is-empty {
        .c-fileinput__file-list {
            display: none;
        }
    }

    &.invalid-files {
        .c-fileinput__accepted-files {
            color: $c-fileinput-danger-color;
            opacity: 1;
        }
    }

    &.file-size-error {
        .c-fileinput__maximum-size {
            color: $c-fileinput-danger-color;
            opacity: 1;
        }
    }

    .c-fileinput__accepted-files-wrapper {
        position: relative;
        display: flex;
        justify-content: space-between;
        width: 100%;
        gap: calc(#{var(--base)} * 2);
        top: calc(#{var(--base)} * 2);
        bottom: calc(#{var(--base)} * 1.5);
        font-size: $c-fileinput-meta-font-size;
        transition: all 0.2s ease-in-out;
        user-select: none;
    }

    .c-fileinput__filecounter,
    .c-fileinput__accepted-files,
    .c-fileinput__maximum-size {
        opacity: .5;
    }

    /* File counter */
    .c-fileinput__filecounter {
        user-select: none;
        position: absolute;
        right: calc(#{var(--base)} * 2);
        bottom: calc(#{var(--base)} * 1.5);
        opacity: .5;
        font-size: $c-fileinput-meta-font-size;
        transition: all 0.2s ease-in-out;
        user-select: none;
    }
 
    /* File counter */ 
    .c-fileinput__filecounter {
        white-space: nowrap;
        &::before {
            content: attr(data-counter-current);
        }
        &::after {
            content: attr(data-counter-max);
        }

        &.do-animate {
            animation: puff-in-center 0.2s cubic-bezier(0.470, 0.000, 0.745, 0.715) both;
        }
    }

    &.is-full {
        .c-fileinput__filecounter {
            opacity: 1;
            color: $c-fileinput-success-color;
            font-weight: bold;
        }
    }

    /* Invalid */
    &.is-invalid {
        .c-fileinput__area {
            border-color: $c-fileinput-danger-color;
            background-color: $c-fileinput-danger-background;
        }
    }

    &.c-fileinput--preview {
        .c-fileinput__item-remove-button {
            vertical-align: unset;
            border-top-right-radius: $c-fileinput-preview-border-radius;
        }

        .c-fileinput__attachment-icon {
            display: none;
        }

        .c-fileinput__item {
            position: relative;
        }

        .is-unsupported {
            background-color: var(--color--white);

            .c-fileinput__attachment-icon {
                display: block;
                
                &::after {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                }
            }
        }

        .c-fileinput__info-container {
            max-width: calc(var(--base) * 25);
            display: flex;
            gap: calc(#{var(--base)} * .5);
        }

        .c-fileinput__item-name {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1 1 auto;
            min-width: 0;
        }

        .c-fileinput__item-size {
            white-space: nowrap;
        }


        .c-fileinput__item-icon-wrapper,
        .c-fileinput__item-remove {
            position: absolute;
            top: 0;
        }

        .c-fileinput__item-remove {
            display: inline-flex;
            right: 0;
        }
        
        .c-fileinput__item-icon-wrapper {
            left: calc(#{var(--base)} * .5);
        }

        .c-fileinput__item-preview {
            width: calc(var(--base) * 25);
            aspect-ratio: 16 / 9;
            border-radius: $c-fileinput-preview-border-radius;
            corner-shape: var(--corner-shape);
            filter: $c-fileinput-preview-shadow;
            overflow: hidden;

            & > * {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
        }

        .c-fileinput__item-icon-wrapper {
            aspect-ratio: unset;
            height: unset;
        }

        .c-fileinput__item-remove {
            border-left: none;
            margin-left: unset;
            border-radius: unset;
        }
    }
}

/* Amnimation */
 @keyframes puff-in-center {
    0% {
      filter: $c-fileinput-item-shadow blur(4px);
      opacity: 0;
    }
    100% {
      filter: $c-fileinput-item-shadow blur(0px);
      opacity: 1;
    }
  }
  