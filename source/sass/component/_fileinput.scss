@use "../mixin/cover";
@use "../setting/var_border-radius";
@use "../setting/var_colors";
@use "../setting/var_default";
@use "../setting/var_properties";

$c-field-border-color: var(--c-field-border-color, var(--color-border-input, var_colors.$color-light)) !default;
$c-field-border-radius: var(--c-field-border-radius, 0.25) !default;
$c-field-border-width: var(--c-field-border-width, var(--border-width-input, 1px)) !default;

$c-field-background-color: var(--c-field-background-color, var_colors.$color-form-fields) !default;
$c-field-danger-color: var(--c-field-danger-color, var(--color-danger, var_colors.$color-form-fields-border-error)) !default;
$c-field-danger-background-color: var(--c-field-danger-background-color, var_colors.$color-form-fields-error) !default;

.c-fileinput {

    /* Actual input (hide) */
    .c-fileinput__input {
        width: 1px;
        height: 1px;
        position: absolute;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
        padding: 0;
        margin: 0;
        opacity: 0;
        z-index: -1;
    }

    /* Is dragging animations */
    &.is-dragging:not(.is-full) {
        .js-file-input-drop {
            outline: 3px dashed var_colors.$color-lighter;
            border-radius: var_border-radius.$border-radius-lg;
            outline-offset: calc(#{var_default.$base} * 1.5);
            width: calc(#{var_default.$base} * 40);
            max-width: calc(100% - calc(#{var_default.$base} * 2.5));
            display: flex;
        }

        .js-file-input-button {
            display: none;
        }
    }

    

    &.is-dragging.is-full {
        .js-file-input-drop {
            display: none;
        }

        // Disable drop area visually
        .c-fileinput__area {
            &::after {
                @include cover.cover();
                content: "\1F6AB"; /* Unicode for ðŸš« */
                font-size: 3rem; /* Adjust the size as needed */
                display: flex;
                justify-content: center;
                align-items: center;
                text-align: center; /* Center the content horizontally */
                line-height: 1; /* Adjust line height to remove any extra space */
                filter: grayscale(100%) brightness(0) contrast(100%);
                opacity: .2;
                z-index: var_properties.$level-2;
            }
            &::before {
                content: "";
                @include cover.cover();
                background: rgba(255, 255, 255, 0.5); /* Dim the background */
                z-index: var_properties.$level-1;
            }
        }
    }

    &:not(.is-dragging) {
        .js-file-input-drop {
            display: none;
        }
    }

    .js-file-input-button,
    .js-file-input-drop {
        animation: puff-in-center 0.2s cubic-bezier(0.470, 0.000, 0.745, 0.715) both;
    }

    /* Drop area */
    .c-fileinput__area {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: calc(#{var_default.$base} * 4);
        border-radius: $c-field-border-radius;
        background-color: $c-field-background-color;
        border: $c-field-border-width solid $c-field-border-color;
        box-shadow: inset 0 0 50px 50px rgba(0,0,0,0.02);
        transition: all 0.2s ease-in-out;
    }

    /* List container */
    .c-fileinput__file-list {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        gap: calc(#{var_default.$base} * 2);
        margin-top: calc(#{var_default.$base} * 2);
        width: 100%;
        padding: calc(#{var_default.$base} * 2);    
    }

    /* Items uploaded */
    .c-fileinput__item {
        .c-fileinput__item-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 calc(#{var_default.$base} * .5);
            background-color: var_colors.$color-lightest;
            border-radius: var_border-radius.$border-radius-lg;
            margin: 0;
            filter: var_properties.$drop-shadow-1;
            height: calc(#{var_default.$base} * 5.5);
            animation: puff-in-center 0.2s cubic-bezier(0.470, 0.000, 0.745, 0.715) both;
        }

        .c-fileinput__item-remove {
            border-left: 1px solid var_colors.$color-lighter;
            margin-left: calc(#{var_default.$base} * 2);
            border-radius: 0 100px 100px 0;
        }

        .c-fileinput__item-icon-wrapper {
            aspect-ratio: 1 / 1;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .c-fileinput__item-text {
            display: flex;
            flex-wrap: nowrap;
            align-items: center;
            gap: #{var_default.$base};

            .c-fileinput__item-name {
                max-width: calc(#{var_default.$base} * 20);
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .c-fileinput__item-size {
                white-space: nowrap;
                font-size: .7em;

                &::before {
                    content: "(";
                }
                &::after {
                    content: ")";
                }
            }
        }
    }

    /* Is empty */
    &.is-empty {
        .c-fileinput__file-list {
            display: none;
        }
    }

    &.invalid-files {
        .c-fileinput__accepted-files {
            color: $c-field-danger-color;
            opacity: 1;
        }
    }

    &.file-size-error {
        .c-fileinput__maximum-size {
            color: $c-field-danger-color;
            opacity: 1;
        }
    }

    .c-fileinput__accepted-files-wrapper {
        position: relative;
        display: flex;
        justify-content: space-between;
        width: 100%;
        gap: calc(#{var_default.$base} * 2);
        top: calc(#{var_default.$base} * 2);
        bottom: calc(#{var_default.$base} * 1.5);
        font-size: .7em;
        transition: all 0.2s ease-in-out;
        user-select: none;
    }

    .c-fileinput__filecounter,
    .c-fileinput__accepted-files,
    .c-fileinput__maximum-size {
        opacity: .5;
    }
 
    /* File counter */ 
    .c-fileinput__filecounter {
        user-select: none;
        position: absolute;
        right: calc(#{var_default.$base} * 2);
        bottom: calc(#{var_default.$base} * 1.5);
        opacity: .5;
        font-size: .7em;
        transition: all 0.2s ease-in-out;
        user-select: none;
    }
 
    /* File counter */ 
    .c-fileinput__filecounter {
        white-space: nowrap;
        &::before {
            content: attr(data-counter-current);
        }
        &::after {
            content: attr(data-counter-max);
        }

        &.do-animate {
            animation: puff-in-center 0.2s cubic-bezier(0.470, 0.000, 0.745, 0.715) both;
        }
    }

    &.is-full {
        .c-fileinput__filecounter {
            opacity: 1;
            color: var_colors.$color-success-dark;
            font-weight: bold;
        }
    }

    /* Invalid */
    &.is-invalid {
        .c-fileinput__area {
            border-color: $c-field-danger-color;
            background-color: $c-field-danger-background-color;
        }
    }

    &.c-fileinput--preview {
        .c-fileinput__item-remove-button {
            vertical-align: unset;
            border-top-right-radius: var_border-radius.$border-radius-md;
        }

        .c-fileinput__attachment-icon {
            display: none;
        }

        .c-fileinput__item {
            position: relative;
        }

        .is-unsupported {
            background-color: white;

            .c-fileinput__attachment-icon {
                display: block;
                
                &::after {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                }
            }
        }

        .c-fileinput__info-container {
            max-width: calc(var_default.$base * 25);
            display: flex;
            gap: calc(#{var_default.$base} * .5);
        }

        .c-fileinput__item-name {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1 1 auto;
            min-width: 0;
        }

        .c-fileinput__item-size {
            white-space: nowrap;
        }


        .c-fileinput__item-icon-wrapper,
        .c-fileinput__item-remove {
            position: absolute;
            top: 0;
        }

        .c-fileinput__item-remove {
            display: inline-flex;
            right: 0;
        }
        
        .c-fileinput__item-icon-wrapper {
            left: calc(#{var_default.$base} * .5);
        }

        .c-fileinput__item-preview {
            width: calc(var_default.$base * 25);
            aspect-ratio: 16 / 9;
            border-radius: var_border-radius.$border-radius-md;
            filter: var_properties.$drop-shadow-2;
            overflow: hidden;

            & > * {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
        }

        .c-fileinput__item-icon-wrapper {
            aspect-ratio: unset;
            height: unset;
        }

        .c-fileinput__item-remove {
            border-left: none;
            margin-left: unset;
            border-radius: unset;
        }
    }
}

/* Amnimation */
 @keyframes puff-in-center {
    0% {
      filter: var_properties.$drop-shadow-1 blur(4px);
      opacity: 0;
    }
    100% {
      filter: var_properties.$drop-shadow-1 blur(0px);
      opacity: 1;
    }
  }
  